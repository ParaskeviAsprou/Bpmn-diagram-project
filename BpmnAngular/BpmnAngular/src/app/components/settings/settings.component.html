<div class="settings-container">
  <mat-card class="settings-card">
    <mat-card-header>
      <mat-card-title>
        <h1>Settings</h1>
      </mat-card-title>
      <mat-card-subtitle>Manage your account settings and preferences</mat-card-subtitle>
    </mat-card-header>

    <!-- Permission Notice -->
    <mat-card-content *ngIf="isViewerOnly">
      <div class="permission-notice">
        <mat-icon color="warn">warning</mat-icon>
        <span><strong>Notice:</strong> You have view-only access. Contact an administrator to modify settings.</span>
      </div>
    </mat-card-content>

    <!-- Loading State -->
    <mat-card-content *ngIf="loading">
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Loading settings...</p>
      </div>
    </mat-card-content>

    <!-- Main Content -->
    <mat-card-content *ngIf="!loading">
      <mat-tab-group>
        
        <!-- Profile Tab -->
        <mat-tab label="Profile">
          <form [formGroup]="profileForm" (ngSubmit)="onSaveProfile()">
            <div class="form-section">
              <h3>Personal Information</h3>
              
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>First Name *</mat-label>
                  <input matInput type="text" formControlName="firstName" [disabled]="isFormDisabled" />
                  <mat-icon matSuffix>person</mat-icon>
                  <mat-error *ngIf="profileForm.get('firstName')?.invalid && profileForm.get('firstName')?.touched">
                    First name is required
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Last Name *</mat-label>
                  <input matInput type="text" formControlName="lastName" [disabled]="isFormDisabled" />
                  <mat-icon matSuffix>person</mat-icon>
                  <mat-error *ngIf="profileForm.get('lastName')?.invalid && profileForm.get('lastName')?.touched">
                    Last name is required
                  </mat-error>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Email Address *</mat-label>
                  <input matInput type="email" formControlName="email" [disabled]="isFormDisabled" />
                  <mat-icon matSuffix>email</mat-icon>
                  <mat-error *ngIf="profileForm.get('email')?.invalid && profileForm.get('email')?.touched">
                    Please enter a valid email address
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Phone Number</mat-label>
                  <input matInput type="tel" formControlName="phone" [disabled]="isFormDisabled" />
                  <mat-icon matSuffix>phone</mat-icon>
                </mat-form-field>
              </div>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Address</mat-label>
                <textarea matInput formControlName="address" [disabled]="isFormDisabled" rows="3"></textarea>
                <mat-icon matSuffix>home</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Profile Picture URL</mat-label>
                <input matInput type="text" formControlName="profilePicture" [disabled]="isFormDisabled" />
                <mat-icon matSuffix>image</mat-icon>
              </mat-form-field>

              <div class="button-group" *ngIf="!isFormDisabled">
                <button mat-button type="button">Cancel</button>
                <button mat-raised-button color="primary" type="submit" [disabled]="profileForm.invalid || saving">
                  <mat-spinner *ngIf="saving" diameter="20"></mat-spinner>
                  Save Profile
                </button>
              </div>
            </div>
          </form>
        </mat-tab>

        <!-- Preferences Tab -->
        <mat-tab label="Preferences">
          <form [formGroup]="preferencesForm" (ngSubmit)="onSavePreferences()">
            <div class="form-section">
              <h3>Application Preferences</h3>
              
              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Theme</mat-label>
                  <mat-select formControlName="theme" [disabled]="isFormDisabled">
                    <mat-option value="light">Light</mat-option>
                    <mat-option value="dark">Dark</mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Language</mat-label>
                  <mat-select formControlName="language" [disabled]="isFormDisabled">
                    <mat-option *ngFor="let lang of languages" [value]="lang.code">
                      {{ lang.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Timezone</mat-label>
                  <mat-select formControlName="timezone" [disabled]="isFormDisabled">
                    <mat-option *ngFor="let tz of timezones" [value]="tz.value">
                      {{ tz.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Date Format</mat-label>
                  <mat-select formControlName="dateFormat" [disabled]="isFormDisabled">
                    <mat-option *ngFor="let format of dateFormats" [value]="format.value">
                      {{ format.name }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <div class="form-section">
              <h3>Notification Preferences</h3>
              <div formGroupName="notifications">
                <div class="checkbox-group">
                  <mat-checkbox formControlName="email" [disabled]="isFormDisabled">
                    Email Notifications
                  </mat-checkbox>
                  <mat-checkbox formControlName="inApp" [disabled]="isFormDisabled">
                    In-App Notifications
                  </mat-checkbox>
                  <mat-checkbox formControlName="push" [disabled]="isFormDisabled">
                    Push Notifications
                  </mat-checkbox>
                </div>
              </div>

              <div class="button-group" *ngIf="!isFormDisabled">
                <button mat-button type="button">Reset</button>
                <button mat-raised-button color="primary" type="submit" [disabled]="preferencesForm.invalid || saving">
                  <mat-spinner *ngIf="saving" diameter="20"></mat-spinner>
                  Save Preferences
                </button>
              </div>
            </div>
          </form>
        </mat-tab>

        <!-- Security Tab -->
        <mat-tab label="Security">
          <form [formGroup]="securityForm" (ngSubmit)="onSaveSecurity()">
            <div class="form-section">
              <h3>Security Settings</h3>
              
              <div class="checkbox-group">
                <mat-checkbox formControlName="twoFactorAuth" [disabled]="isFormDisabled">
                  <div class="checkbox-content">
                    <strong>Two-Factor Authentication</strong><br>
                    <small>Add an extra layer of security to your account</small>
                  </div>
                </mat-checkbox>

                <mat-checkbox formControlName="loginNotifications" [disabled]="isFormDisabled">
                  <div class="checkbox-content">
                    <strong>Login Notifications</strong><br>
                    <small>Get notified when someone logs into your account</small>
                  </div>
                </mat-checkbox>
              </div>

              <mat-form-field appearance="outline" class="session-timeout">
                <mat-label>Session Timeout (minutes)</mat-label>
                <input matInput type="number" formControlName="sessionTimeout" [disabled]="isFormDisabled" min="1" max="480" />
                <mat-icon matSuffix>schedule</mat-icon>
                <mat-error *ngIf="securityForm.get('sessionTimeout')?.invalid && securityForm.get('sessionTimeout')?.touched">
                  Session timeout must be between 1 and 480 minutes
                </mat-error>
              </mat-form-field>

              <div class="button-group" *ngIf="!isFormDisabled">
                <button mat-button type="button">Cancel</button>
                <button mat-raised-button color="primary" type="submit" [disabled]="securityForm.invalid || saving">
                  <mat-spinner *ngIf="saving" diameter="20"></mat-spinner>
                  Save Security Settings
                </button>
              </div>
            </div>
          </form>
        </mat-tab>

        <!-- Password Tab -->
        <mat-tab label="Password">
          <form [formGroup]="passwordForm" (ngSubmit)="onChangePassword()">
            <div class="form-section">
              <h3>Change Password</h3>
              
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Current Password *</mat-label>
                <input matInput type="password" formControlName="currentPassword" [disabled]="isFormDisabled" />
                <mat-icon matSuffix>lock</mat-icon>
                <mat-error *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
                  Current password is required
                </mat-error>
              </mat-form-field>

              <div class="form-row">
                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>New Password *</mat-label>
                  <input matInput type="password" formControlName="newPassword" [disabled]="isFormDisabled" />
                  <mat-icon matSuffix>lock</mat-icon>
                  <mat-error *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
                    Password must be at least 8 characters long
                  </mat-error>
                </mat-form-field>

                <mat-form-field appearance="outline" class="half-width">
                  <mat-label>Confirm New Password *</mat-label>
                  <input matInput type="password" formControlName="confirmPassword" [disabled]="isFormDisabled" />
                  <mat-icon matSuffix>lock</mat-icon>
                  <mat-error *ngIf="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
                    Please confirm your password
                  </mat-error>
                </mat-form-field>
              </div>

              <mat-error *ngIf="passwordForm.hasError('passwordMismatch') && passwordForm.get('confirmPassword')?.touched" class="password-mismatch">
                Passwords do not match
              </mat-error>

              <div class="button-group" *ngIf="!isFormDisabled">
                <button mat-button type="button" (click)="passwordForm.reset()">Clear</button>
                <button mat-raised-button color="primary" type="submit" [disabled]="passwordForm.invalid || saving">
                  <mat-spinner *ngIf="saving" diameter="20"></mat-spinner>
                  Change Password
                </button>
              </div>
            </div>
          </form>
        </mat-tab>
      </mat-tab-group>
    </mat-card-content>
  </mat-card>
</div>