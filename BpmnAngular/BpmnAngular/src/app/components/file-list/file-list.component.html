<div class="container">
  <!-- Header -->
  <div class="header-section">
    <div class="header-content">
      <div class="header-title">
        <h1>{{ translate('fileList.title') }}</h1>
        <div class="user-badge">
          <span class="badge">{{ currentUserFullName }}</span>
          <span class="badge">{{ currentUserRole }}</span>
        </div>
      </div>
      <div class="permissions">
        <div style="display: flex; gap: 0.5rem;">
          <span class="badge" *ngIf="canView">{{ translate('fileList.view') }}</span>
          <span class="badge" *ngIf="canEdit">{{ translate('fileList.edit') }}</span>
          <span class="badge" *ngIf="canCreate">{{ translate('common.create') }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Breadcrumb Navigation -->
  <div class="breadcrumb-container" *ngIf="hasFolderSupport()">
    <div class="breadcrumb">
      <button class="breadcrumb-item" (click)="navigateToRoot()" [class.active]="!isInFolder()">
        <span class="material-icons">home</span>
        {{ translate('fileList.allFiles') }}
      </button>
      <span class="breadcrumb-separator" *ngIf="isInFolder()">
        <span class="material-icons">chevron_right</span>
      </span>
      <span class="breadcrumb-item current" *ngIf="isInFolder()">
        <span class="material-icons">folder</span>
        {{ currentFolderName }}
      </span>
    </div>
  </div>

  <!-- Search & Actions -->
  <div class="search-container">
    <div class="search-wrapper">
      <input type="text" class="search-input" [placeholder]="translate('fileList.searchPlaceholder')" [(ngModel)]="searchTerm" (input)="filterFiles()">
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="navigateToModeler()" *ngIf="canCreate">
          <span class="material-icons">add</span>
          {{ translate('fileList.newDiagram') }}
        </button>
        <button class="btn btn-secondary" (click)="uploadFile()" *ngIf="canCreate">
          <span class="material-icons">upload</span>
          {{ translate('fileList.upload') }}
        </button>
        <button class="btn btn-secondary" (click)="openCreateFolderDialog()" *ngIf="shouldShowCreateFolderButton()">
          <span class="material-icons">create_new_folder</span>
          {{ translate('fileList.newFolder') }}
        </button>
      </div>
    </div>
  </div>

  <!-- Folders Section -->
  <div class="folders-section" *ngIf="shouldShowFolders()">
    <h3 class="section-title">
      <span class="material-icons">folder</span>
      {{ translate('fileList.folders') }}
    </h3>
    <div class="folders-grid">
      <div class="folder-card" *ngFor="let folder of folders; trackBy: trackByFolderId">
        <div class="folder-header">
          <div class="folder-icon">
            <span class="material-icons">folder</span>
          </div>
          <div class="folder-actions">
            <button class="icon-btn" (click)="renameFolder(folder)" *ngIf="canEdit" [title]="translate('fileList.edit')">
              <span class="material-icons">edit</span>
            </button>
            <button class="icon-btn delete" (click)="deleteFolder(folder)" *ngIf="canDelete" [title]="translate('fileList.delete')">
              <span class="material-icons">delete</span>
            </button>
          </div>
        </div>
        
        <div class="folder-content" (click)="navigateToFolder(folder)">
          <h4 class="folder-name">{{ folder.folderName }}</h4>
          <p class="folder-description">{{ folder.description || translate('fileList.noDescription') }}</p>
          
          <div class="folder-meta">
            <div class="meta-item">
              <span class="material-icons">schedule</span>
              <span>{{ formatDate(folder.createdTime) }}</span>
            </div>
            <div class="meta-item">
              <span class="material-icons">person</span>
              <span>{{ folder.createdBy || translate('fileList.unknown') }}</span>
            </div>
          </div>
        </div>
        
        <div class="folder-footer">
          <button class="btn btn-primary" (click)="navigateToFolder(folder)">
            <span class="material-icons">folder_open</span>
            {{ translate('fileList.open') }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Files Grid -->
  <div class="files-grid" *ngIf="!isLoading && appFile.length > 0">
    <div class="file-card" *ngFor="let file of appFile; trackBy: trackByFileId">
      <div class="file-header">
        <div class="file-icon-wrapper">
          <div class="file-icon">
            <span class="material-icons">description</span>
          </div>
          <span class="file-type">{{ getFileTypeLabel(file) }}</span>
        </div>
        <div class="file-actions">
          <button class="icon-btn edit" (click)="openFile(file)" *ngIf="canEditFile(file)" [title]="translate('fileList.edit')">
            <span class="material-icons">edit</span>
          </button>
          <button class="icon-btn" (click)="downloadFile(file)" *ngIf="canDownloadFile(file)" [title]="translate('fileList.download')">
            <span class="material-icons">download</span>
          </button>
          <button class="icon-btn" (click)="downloadFile(file, 'pdf')" *ngIf="canExportFile(file)" [title]="translate('fileList.exportPdf')">
            <span class="material-icons">picture_as_pdf</span>
          </button>
          <button class="icon-btn" (click)="downloadFile(file, 'png')" *ngIf="canExportFile(file)" [title]="translate('fileList.exportPng')">
            <span class="material-icons">image</span>
          </button>
          <button class="icon-btn" (click)="openVersionHistory(file)" *ngIf="canView" [title]="translate('fileList.versionHistory')">
            <span class="material-icons">history</span>
          </button>
          <button class="icon-btn delete" (click)="deleteFile(file.id!)" *ngIf="canDeleteFile(file)" [title]="translate('fileList.delete')">
            <span class="material-icons">delete</span>
          </button>
        </div>
      </div>
      
      <div class="file-content">
        <h3 class="file-name">{{ file.fileName || 'Untitled' }}</h3>
        <p class="file-description">{{ file.description || translate('fileList.noDescription') }}</p>
        
        <div class="file-meta">
          <div class="meta-item">
            <span class="material-icons">storage</span>
            <span>{{ formatFileSize(file.fileSize || 0) }}</span>
          </div>
          <div class="meta-item">
            <span class="material-icons">schedule</span>
            <span>{{ formatDate(file.uploadTime || file.updatedTime) }}</span>
          </div>
          <div class="meta-item">
            <span class="material-icons">person</span>
            <span>{{ file.createdBy || translate('fileList.unknown') }}</span>
          </div>
          <div class="meta-item">
            <span class="material-icons">bookmark</span>
            <span>v{{ file.currentVersion || 1 }}</span>
          </div>
        </div>

        <div class="file-permissions">
          <span class="permission-badge view" *ngIf="canView">
            <span class="material-icons">visibility</span>
            {{ translate('fileList.view') }}
          </span>
          <span class="permission-badge edit" *ngIf="canEditFile(file)">
            <span class="material-icons">edit</span>
            {{ translate('fileList.edit') }}
          </span>
        </div>
      </div>

      <div class="file-footer">
        <button class="btn btn-primary" (click)="openFile(file)">
          <span class="material-icons">edit</span>
          {{ translate('fileList.open') }}
        </button>
        <button class="btn btn-secondary" (click)="downloadFile(file, 'pdf')" *ngIf="canExportFile(file)" [title]="translate('fileList.exportPdf')">
          <span class="material-icons">picture_as_pdf</span>
        </button>
        <button class="btn btn-secondary" (click)="downloadFile(file, 'png')" *ngIf="canExportFile(file)" [title]="translate('fileList.exportPng')">
          <span class="material-icons">image</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="loading-spinner"></div>
    <h3>{{ translate('fileList.loadingFiles') }}</h3>
    <p>{{ translate('fileList.loadingMessage') }}</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && appFile.length === 0" class="empty-state">
    <div class="empty-icon">
      <span class="material-icons">folder_open</span>
    </div>
    <h3>{{ translate('fileList.emptyStateTitle') }}</h3>
    <p>{{ translate('fileList.emptyStateMessage') }}</p>
    <div class="action-buttons">
      <button class="btn btn-primary" (click)="navigateToModeler()" *ngIf="canCreate">
        <span class="material-icons">add</span>
        {{ translate('fileList.createNewDiagram') }}
      </button>
      <button class="btn btn-secondary" (click)="uploadFile()" *ngIf="canCreate">
        <span class="material-icons">upload</span>
        {{ translate('fileList.uploadFile') }}
      </button>
    </div>
  </div>

  <!-- Hidden file input for uploads -->
  <input #fileInput type="file" accept=".bpmn,.xml" (change)="onFileSelected($event)" style="display: none;">
</div>